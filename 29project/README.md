#  Отчетная работа OTUS Pro

Цель:
закрепить и продемонстрировать полученные знания и навыки;
создать веб-проект;
подготовить портфолио для работодателя;


Описание/Пошаговая инструкция выполнения домашнего задания:
Создание рабочего проекта
веб проект с развертыванием нескольких виртуальных машин должен отвечать следующим требованиям:

включен https;
основная инфраструктура в DMZ зоне;
файрвалл на входе;
сбор метрик и настроенный алертинг;
везде включен selinux;
организован централизованный сбор логов;
организован backup.

### Запускаем установку всего стека виртуальных машин

[Vagranfile](https://github.com/AlexeyWu/test_vm/blob/main/29project/Vagrantfile)
Запускаем:
``` 
vagrant up
```
Происходит установка виртуальных машин, а так же настройка их с помощью Ansible

В связи с недоступностью некоторых серверов из-за санкций, с установкой настроек возникают проблемы вида что то устанавливается с ВПН, 
что то не ставится с запущенным ВПН, приходится перезапускать конкретные настройки включая\либо отключая ВПН (мб это еще зависит от того,
какой страны получается ВПН) (в плане на како стадии отвалится) командой, например: vagrant up --provizion zabbix 

Пример можно посмотреть в файле лога установки настроек [nginx](https://github.com/AlexeyWu/test_vm/blob/main/29project/loginstall.txt)
Как раз что то поставилось без ВПН, потом его пришлось включить чтобы поставился например filebeat 

После усановки и настройки мы получаем стенд с иртуальными машинами в зоне DMZ
![image](https://github.com/AlexeyWu/test_vm/blob/main/29project/pict/shema.png)
 Хосты | IP адрес
------| ---------
Router | 192.168.10.10
WEB (Nginx) | 192.168.10.20
MySQL (MASTER) | 192.168.10.30
MySQL (SLAVE) | 192.168.10.35
LogServer (ELK) | 192.168.10.40
Monitoring (Zabbix) | 192.168.10.50
Data (iSCSI)`*` | 192.168.10.100
Backup (NFS Server) | 192.168.10.90

### Описание Хостов и их предназночения в стенде 

Router - вхоодящий роутер который закрывает доступ в ДМЗ зону с внешней сети разрешая только передачу 
         443 порта на WEB  сервер 192.168.10.20
        
WEB    - Хост на котором установлен стек: Nginx + PHP-FPM + Wordpress (БД находится на MySQL Master + Контент на подключенном диске iSCSI) 
       + Zabbix Agent (для мониторина Zabbix Server) + Filebaet (для передачи логов в ELK c Logstash) 
![image](https://github.com/AlexeyWu/test_vm/blob/main/29project/pict/site.png)
MySQL Master - Хост на котором установлен MySQL в статусе Мастера в котором создана БД worpress. С него проиходит репликация на MySQL Slave

MySQL Slave - на него происходит репликация данных с Мастера + если мастер не доступен можно переключить работу WEB
              Как переключить описано  [здесь](https://github.com/AlexeyWu/test_vm/blob/main/29Project/repl_mysql/README.md)
              
ELK - Поднят стек Elasticserch+Logstash+Kibana для сбора и визуализации собранных логов 
![image](https://github.com/AlexeyWu/test_vm/blob/main/29project/pict/elk.png)

Zabbix - мониторинг хостов через агентов установленных на хостах
![image](https://github.com/AlexeyWu/test_vm/blob/main/29project/pict/zabbix.png)

iSCSI - Хост на котором сделано зеркало и настроен таргет - к которому подключется WEB хост и на нем лежит контент Wordpress 
        не претендует на прод, сделан как увеличение надежности сохранности контента.
        
NFS Server - на этом хосте поднят NFS Server и подключается как шара для бэкапов на Хостах баз данных и WEB 
             в ручную (скрипты на WEB для бэкапа контента и его восстановления находятся в /home/vagrant) или по крону (можно 
             сделать добавив строчку при настроке через Ansible) - так же скрипты лежат на SQLMaster /home/vagrant для дополнительного 
             бэкапа и восстановления БД)       
        
### Доступ к службам

> Для доступа к веб-проекту на Wordpress необходимо на хост машине прописать адрес роутера (Router): `192.168.10.10 dreamscity.ru.

Сервис | Адрес
------| ---------
Wordpress (Nginx+PHP-FPM) | https://192.168.10.20 (https://dremscity.ru)
ELK | http://192.168.10.40:5601
Zabbix | http://192.168.10.50/zabbix


SSL сертификат для сайта - сделан по следствам ДНС в https://letsencrypt.org/
![image](https://github.com/AlexeyWu/test_vm/blob/main/29project/pict/crt-dream.png)

